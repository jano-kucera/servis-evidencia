@let order = ordersService.selectedOrder;

@if (order) {
    <pre>{{ order | json }}</pre>
    <mat-card appearance="outlined">
        <!-- Header -->
        <mat-card-header>
            <mat-card-title-group>
                <!-- Info -->
                <mat-card-title>Servis 4</mat-card-title>

                <!-- Edit toggle -->
                <mat-slide-toggle
                    matSuffix
                    labelPosition="before"
                    [(ngModel)]="editing">
                    Povoliť úpravy
                </mat-slide-toggle>
            </mat-card-title-group>
        </mat-card-header>

        <mat-divider />

        <!-- Main fields -->
        <mat-card-content>
            <div class="order-fields-container">
                <!-- License plate -->
                <mat-form-field>
                    <mat-label>ŠPZ</mat-label>
                    <input
                        matInput
                        [readonly]="!editing"
                        [(ngModel)]="order.licensePlate" />
                </mat-form-field>

                <!-- Manufacturer -->
                <mat-form-field>
                    <mat-label>Značka</mat-label>
                    <input
                        matInput
                        [readonly]="!editing"
                        [(ngModel)]="order.manufacturer" />
                </mat-form-field>

                <!-- Model -->
                <mat-form-field>
                    <mat-label>Model</mat-label>
                    <input
                        matInput
                        [readonly]="!editing"
                        [(ngModel)]="order.model" />
                </mat-form-field>

                <!-- Customer -->
                <mat-form-field>
                    <mat-label>Zákazník</mat-label>
                    <input
                        matInput
                        [readonly]="!editing"
                        [(ngModel)]="order.customer" />
                </mat-form-field>

                <!-- VIN -->
                <mat-form-field>
                    <mat-label>VIN</mat-label>
                    <input
                        matInput
                        [readonly]="!editing"
                        [(ngModel)]="order.vin" />
                </mat-form-field>

                <!-- Work started/ended -->
                <mat-form-field>
                    <mat-label>Prevzaté - Odovzdané</mat-label>
                    <mat-date-range-input [rangePicker]="picker">
                        <input
                            matStartDate
                            [(ngModel)]="order.workStarted" />
                        <input
                            matEndDate
                            [(ngModel)]="order.workEnded" />
                    </mat-date-range-input>
                    <mat-datepicker-toggle
                        matIconSuffix
                        [for]="picker" />
                    <mat-date-range-picker #picker />
                </mat-form-field>
            </div>

            <!-- Notes -->
            <mat-form-field style="width: 100%">
                <mat-label>Poznámky</mat-label>
                <textarea
                    matInput
                    cdkTextareaAutosize
                    cdkAutosizeMinRows="1"
                    [(ngModel)]="order.notes">
                </textarea>
            </mat-form-field>

            <mat-divider />

            <!-- Order items -->
            <section
                class="example-container mat-elevation-z8"
                tabindex="0">
                <table
                    mat-table
                    [dataSource]="order.items">
                    <!-- Name Column -->
                    <ng-container matColumnDef="name">
                        <th
                            *matHeaderCellDef
                            mat-header-cell>
                            Name
                        </th>
                        <td
                            *matCellDef="let element"
                            mat-cell>
                            {{ element.name }}
                        </td>
                    </ng-container>

                    <!-- Description Column -->
                    <ng-container matColumnDef="description">
                        <th
                            *matHeaderCellDef
                            mat-header-cell>
                            Description
                        </th>
                        <td
                            *matCellDef="let element"
                            mat-cell>
                            {{ element.description }}
                        </td>
                    </ng-container>

                    <!-- Quantity Column -->
                    <ng-container matColumnDef="quantity">
                        <th
                            *matHeaderCellDef
                            mat-header-cell>
                            Quantity
                        </th>
                        <td
                            *matCellDef="let element"
                            mat-cell>
                            {{ element.quantity }}
                        </td>
                    </ng-container>

                    <!-- Price Column -->
                    <ng-container matColumnDef="price">
                        <th
                            *matHeaderCellDef
                            mat-header-cell>
                            Price
                        </th>
                        <td
                            *matCellDef="let element"
                            mat-cell>
                            {{ element.price }}
                        </td>
                    </ng-container>

                    @let displayedColumns =
                        ["description", "name", "price", "quantity"];
                    <tr
                        *matHeaderRowDef="displayedColumns; sticky: true"
                        mat-header-row></tr>
                    <tr
                        *matRowDef="let row; columns: displayedColumns"
                        mat-row></tr>
                </table>
            </section>
        </mat-card-content>
    </mat-card>
}
